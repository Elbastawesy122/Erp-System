generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int       @id @default(autoincrement())
  email           String    @unique
  password        String    @db.VarChar(255)
  name            String
  isAdmin         Boolean   @default(false)
  ordersCreated   Order[]   @relation("OrdersCreated")
  ordersAccepted  Order[]   @relation("OrdersAccepted")
  requestsCreated Request[] @relation("RequestsCreated")
  requestsApproved Request[] @relation("RequestsApproved")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Order {
  id           Int        @id @default(autoincrement())
  customerName String
  status       String
  progress     String?    @default("Pending")
  dueDate      DateTime
  createdBy    User       @relation("OrdersCreated", fields: [createdById], references: [id])
  createdById  Int
  acceptedBy   User?      @relation("OrdersAccepted", fields: [acceptedById], references: [id])
  acceptedById Int?
  material     Material[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Request {
  id           Int         @id @default(autoincrement())
  title        String
  description  String
  status       String      @default("Pending")
  createdBy    User        @relation("RequestsCreated", fields: [createdById], references: [id])
  createdById  Int
  approvedBy   User?       @relation("RequestsApproved", fields: [approvedById], references: [id])
  approvedById Int?
  materials    Material[]
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Material {
  id           Int        @id @default(autoincrement())
  materialName String
  quantity     Float
  price        Float?
  order        Order?     @relation(fields: [orderId], references: [id])
  orderId      Int?
  request      Request?   @relation(fields: [requestId], references: [id])
  requestId    Int?
  store        Store?     @relation(fields: [storeId], references: [id])
  storeId      Int?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Store {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  quantity   Float    @default(0)
  materials  Material[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
